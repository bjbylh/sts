{% include "manager/top.html" %}
<!-- BEGIN PAGE LEVEL PLUGINS -->
<link href="/static/metronic/assets/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css"
      rel="stylesheet" type="text/css"/>
<link href="/static/metronic/assets/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css"
      rel="stylesheet" type="text/css"/>
<link href="/static/metronic/assets/global/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/metronic/assets/global/plugins/select2/css/select2-bootstrap.min.css" rel="stylesheet"
      type="text/css"/>
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN THEME GLOBAL STYLES -->
<link href="/static/metronic/assets/global/css/components.min.css" rel="stylesheet" id="style_components"
      type="text/css"/>
<link href="/static/metronic/assets/global/css/plugins.min.css" rel="stylesheet" type="text/css"/>

<link type="text/css" rel="stylesheet" href="/static/jeDate/test/jeDate-test.css">
<link type="text/css" rel="stylesheet" href="/static/jeDate/skin/jedate.css">
<script type="text/javascript" src="/static/jeDate/src/jedate.js"></script>

<!-- hf_data -->

<!-- END THEME GLOBAL STYLES -->
<script src="/static/metronic/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"
        type="text/javascript"></script>
<script src="/static/metronic/assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"
        type="text/javascript"></script>
<script src="/static/metronic/assets/global/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>

<!--script src="/static/metronic/assets/global/plugins/jquery-validation/js/jquery.validate.min.js"
        type="text/javascript"></script>
<script src="/static/metronic/assets/global/plugins/jquery-validation/js/additional-methods.min.js"
        type="text/javascript"></script>
<script src="/static/metronic/assets/global/plugins/jquery-validation/js/localization/messages_zh.min.js"
        type="text/javascript"></script-->

<script src="/static/metronic/assets/global/scripts/app.min.js" type="text/javascript"></script>

<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="/static/metronic/assets/pages/scripts/components-date-time-pickers.js" type="text/javascript"></script>
<script src="/static/metronic/assets/pages/scripts/components-select2.min.js" type="text/javascript"></script>
<!-- END PAGE LEVEL SCRIPTS -->
<script src="/static/arena/js/form.js" type="text/javascript"></script>

<div class="col-md-12">
    <!-- BEGIN EXAMPLE TABLE PORTLET-->
    <div class="portlet light " style="margin-bottom: 0px;padding-bottom: 0px;">
        <div class="portlet-title">
           <div class="caption font-dark">
                <i class="icon-settings font-dark"></i>
                <span class="caption-subject bold uppercase">{{sat.name}}<i class="fa fa-chevron-right"></i>
                    {% if data._id==null %}计算测试项目{% else %} 编辑测试项目 {% endif %}{{projectId}}</span>
            </div>
            <div class="tools"></div>
        </div>
        <div class="portlet-body form" style="padding-top: 8px !important;">
            <input type="hidden" id="stage_id" name="stage_id" value="{{data.stage}}">
            <form class="form-horizontal" id="form_satellite">
                <div class="form-body" style="padding: 0px !important;">
                    <input type="hidden" id="_id" name="_id" value="{{data._id}}">
                    <input type="hidden" id="_satid" name="_satid" value="{{sat.code}}">
                    <input type="hidden" id="_satid1" name="_satid1" value="{{sat.code}}">
                    <input type="hidden" id="projectId" name="projectId" value="{{prj._id}}">
                    <input type="hidden" id="stage_name" name="stage_name" value="{{data.stage_name}}">
                    <div class="alert alert-danger display-hide">
                        <button class="close" data-close="alert"></button>
                        表单验证失败，请检查表单内容.
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2" for="time" value="">测试时间 <span> * </span></label>
                        <div class="col-xs-10">
                            <input type="text" size="10" class="form-control form-control-inline date-picker" id="time" name="time" placeholder="">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2" for="stage">关联阶段<span></span></label>
                        <div class="col-xs-10">
                            <select id="stage" name="stage" class="form-control">

                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2" for="person">测试人</label>
                        <div class="col-xs-10">
                            <input type="person" class="form-control" id="person" name="person" required="required">
<!--
                            <span style='color:#c51b26;font-size:12px;display:none'>测试人地不能为空</span>
-->
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2" for="place">测试场地</label>
                        <div class="col-xs-10">
                            <input type="text" class="form-control" id="place" name="place" required="required">
<!--
                            <span style='color:#c51b26;font-size:12px;display:none'>测试场地不能为空</span>
-->
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2" for="tag">结果标记</label>
                        <div class="col-xs-10">
                            <input type="text" class="form-control" id="tag" name="tag" value="1">
                        </div>
                    </div>
                    <div class="form-group" id="timeroup">
                        <label class="control-label col-xs-2">开始时间</label>
                        <div class="col-xs-10" style="width:34%;">
                            <div class="jeitem">
                                <div class="jeinpbox"><input type="text" class="jeinput" id="testgray1" placeholder="" name="start">
                                    <span style='color:#e73d4a;display:none;margin:5px 0;' id="startend">结束时间不能小于或者等于开始时间</span>
                                </div>
                            </div>
                        </div>
                        <label class="control-label col-xs-2">结束时间</label>
                        <div class="col-xs-10"style="width:32%;">
                            <div class="jeitem">
                                <div class="jeinpbox"><input type="text" class="jeinput" id="testgray2" placeholder="" name="end"></div>
                            </div>
                        </div>
                        <script langguage="JavaScript">

                            today=new Date();
                            testgray2.value=today.getFullYear()+'-'+today.getMonth()+'-'+today.getDay()+' '+today.getHours()+':'+today.getMinutes()+':'+today.getSeconds();
                            testgray1.value=today.getFullYear()+'-'+today.getMonth()+'-'+today.getDay()+' '+today.getHours()+':'+today.getMinutes()+':'+today.getSeconds();
                            time.value=today.getFullYear()+'-'+today.getMonth()+'-'+today.getDay();
                        </script>
                    </div>
                    <div class="form-group">

                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2">异常值统计</label>
                        <div class="col-xs-10">
                            <div class="md-radio-inline">
                                <div class="md-radio">
                                    <input type="radio" id="radio14" name="outlier" class="md-radiobtn" value="是">
                                    <label for="radio14">
                                        <span class="inc"></span>
                                        <span class="check"></span>
                                        <span class="box"></span>是</label>
                                </div>
                                <div class="md-radio has-error">
                                    <input type="radio" id="radio15" name="outlier" class="md-radiobtn" checked="" value="否">
                                    <label for="radio15">
                                        <span class="inc"></span>
                                        <span class="check"></span>
                                        <span class="box"></span>否</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2">项目</label>
                        <div class="col-xs-10">
                            <div class="md-checkbox-inline" id="checkbox_val">
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>

 var callbackdata = function () {
     var checkNum = $("input[name='items']:checked").length;
     var startTime = $("#testgray1").val();
     console.log(startTime)
     var start = new Date(startTime.replace("-", "/").replace("-", "/"));
     console.log(start)
     var endTime = $("#testgray2").val();
     var end = new Date(endTime.replace("-", "/").replace("-", "/"));
     console.log(end)
     $('#stage_name').val($('#stage option:selected').text());
     $("#form_satellite").submit();
     var validate = $("#form_satellite").valid();
     if (validate && checkNum>=1 && end>=start)
         return formBuild('#form_satellite');
     else
     if (checkNum<1){
         $("#checkbox_val #checkMessage").css("display","block");
         $("#checkbox_val").parent().prev().css("color","#e73d4a");
     }else {
         $("#checkbox_val #checkMessage") .css("display","none");
         $("#checkbox_val").parent().prev().css("color","#333333");
     }
     if(end<=start){
         $("#timeroup #startend").css("display","block");
         $("#timeroup label").css("color","#e73d4a");
     }else {
         $("#timeroup #startend") .css("display","none");
         $("#timeroup label").css("color","#333333");
     }
         return null;
 }


 $(document).ready(function () {
     //$("#stage").select2.val("无").trigger('change');
     var text="无";
     $('#stage').html('<option value="' + text + '">' + text + '</option>').trigger("change");
     var rules = {
         name: {
             minlength: 2,
             required: true
         }
     };
     formValid('#form_satellite', rules);


     $('#stage').select2({
         ajax: {
             url: '/manager/project/result/getstage?_satid='+$("#_satid1").val(),
             async: false,
             processResults: function (data) {
                 return {
                     results: data.data
                 };
                 console.log(data);
             }
         }
     });

     //获取多选框的值
     $.ajax({
         url: '/manager/project/autoAnalysis/computingMethodList?_satid=' + $("#_satid1").val()+"&projectId="+$("#projectId").val(),
         type:'GET',
         error: function (request) {
             alert("Connection error");
         },
         success: function (data) {
             var checkhtml='';
            for (var i=0;i<data.length;i++){
                checkhtml='<div class="md-checkbox">';
                checkhtml+='<input type="checkbox" id="checkbox'+i+'" name="items" class="md-check" value="'+data[i]+'">';
                checkhtml+='<label for="checkbox'+i+'">';
                checkhtml+='<span class="inc"></span>';
                checkhtml+='<span class="check"></span>';
                checkhtml+='<span class="box"></span>'+data[i];
                checkhtml+='</label>';
                checkhtml+='</div>';
                $("#checkbox_val").append(checkhtml);
            }
             $("#checkbox_val").append('<span style="color:#e73d4a;display:none;margin:5px 0;" id="checkMessage">至少选中一个</span>');
         }
     });
 });


</script>
<script type="text/javascript" src="/static/jeDate/test/demo.js"></script>
{% include "manager/footer.html" %}