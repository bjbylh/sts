{% include "./top.html" %}
<!-- BEGIN THEME GLOBAL STYLES -->
<link href="/static/metronic/assets/global/css/components.min.css" rel="stylesheet" id="style_components"
      type="text/css"/>
<link href="/static/metronic/assets/global/css/plugins.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/metronic/assets/global/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/metronic/assets/global/plugins/select2/css/select2-bootstrap.min.css" rel="stylesheet"
      type="text/css"/>

<!-- END THEME GLOBAL STYLES -->
<script src="/static/metronic/assets/global/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>
<script src="/static/metronic/assets/global/plugins/jquery-validation/js/jquery.validate.min.js"
        type="text/javascript"></script>
<script src="/static/metronic/assets/global/plugins/jquery-validation/js/additional-methods.min.js"
        type="text/javascript"></script>

<script src="/static/metronic/assets/global/plugins/jquery-validation/js/localization/messages_zh.min.js"
        type="text/javascript"></script>

<script src="/static/metronic/assets/global/scripts/app.min.js" type="text/javascript"></script>

<!-- END PAGE LEVEL SCRIPTS -->
<div class="col-md-12">
    <!-- BEGIN EXAMPLE TABLE PORTLET-->
    <div class="portlet light " style="margin-bottom: 0px;padding-bottom: 0px;">
        <div class="portlet-body form" style="padding-top: 8px !important;">
            <form class="form-horizontal" id="form_satellite">
                <div class="form-body" style="padding: 0px !important;">
                    <input type="hidden" id="_id" name="_id" value="{{data._id}}">
                    <input type="hidden" id="_satid" name="_satid" value="{{sat._id}}">
                    <input type="hidden" id="data" value="{{data.subsysname}}">
                    <div class="alert alert-danger display-hide">
                        <button class="close" data-close="alert"></button>
                        表单验证失败，请检查表单内容.
                    </div>
                    <div class="row">
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="tmid">遥测id</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="tmid" name="tmid" value="{{data.tmid}}">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="tmcode">遥测代号<span> * </span></label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="tmcode" name="tmcode" value="{{data.tmcode}}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="paramid">遥测编号<span> * </span></label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="paramid" name="paramid" value="{{data.paramid}}">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="tmcaption">遥测名称<span> * </span></label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="tmcaption" name="tmcaption" value="{{data.tmcaption}}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="pointno">采集点编号</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="pointno" name="pointno" value="{{data.pointno}}">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="subsysname">分系统名称</label>
                                <div class="col-xs-8">
                                    <select name="subsysname" id="subsysname" class="form-control"></select>
                                    <!--<input type="text" class="form-control" id="subsysname" name="subsysname" value="{{data.subsysname}}">-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="devicecode">所属设备编号</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="devicecode" name="devicecode" value="{{data.devicecode}}">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="subsyscode">分系统编号</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="subsyscode" name="subsyscode" value="{{data.subsyscode}}" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="devicename">所属设备名称</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="devicename" name="devicename" value="{{data.devicename}}">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="mapid">延时/实时id</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="mapid" name="mapid" value="{{data.mapid}}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="isdelay">实遥/延遥</label>
                               <div class="col-xs-8">
                                   <select name="isdelay" id="isdelay" class="form-control">
                                       <option value=0 {% if data.isdelay==0 %}selected{% endif %}>实遥</option>
                                       <option value=1 {% if data.isdelay==1 %}selected{% endif %}>延遥</option>
                                   </select>
                               </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="datatype">参数数据类型</label>
                                <div class="col-xs-8">
                                    <select name="datatype" id="datatype" class="form-control">
                                        <option value=0 {% if data.datatype==0 %}selected{% endif %}>整型</option>
                                        <option value=1 {% if data.datatype==1 %}selected{% endif %}>浮点型</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="channelcode">所属通道编号</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="channelcode" name="channelcode" value="{{data.channelcode}}">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="unit">量纲</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="unit" name="unit" value="{{data.unit}}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="rangeleft">值范围左值</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="rangeleft" name="rangeleft" value="{{data.rangeleft}}">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="rangeright">值范围右值</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="rangeright" name="rangeright" value="{{data.rangeright}}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="imported">是否导入</label>
                                <div class="col-xs-8">
                                    <select name="imported" id="imported" class="form-control">
                                        <option value=0 {% if data.imported==0 %}selected{% endif %}>手工录入</option>
                                        <option value=1 {% if data.imported==1 %}selected{% endif %}>导入</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="type">参数类型</label>
                                <div class="col-xs-8">
                                    <select name="type" id="type" class="form-control">
                                        <option value=0 {% if data.type==0 %}selected{% endif %}>原生参数</option>
                                        <option value=1 {% if data.type==1 %}selected{% endif %}>自定义参数</option>
                                        <option value=2 {% if data.type==2 %}selected{% endif %}>衍生参数</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2" for="lastmodify">最后修改时间</label>
                        <div class="col-xs-10">
                            <input type="text" class="form-control" id="lastmodify" name="lastmodify" value="{{data.lastmodify}}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2" for="positions">位置信息</label>
                        <div class="col-xs-10">
                            <input type="text" class="form-control" id="positions" name="positions" value="{{data.positions}}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2" for="process">方法</label>
                        <div class="col-xs-10">
                            <input type="text" class="form-control" id="process" name="process" value="{{data.process}}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2" for="annotation">值注释</label>
                        <div class="col-xs-10">
                            <input type="text" class="form-control" id="annotation" name="annotation" value="{{data.annotation}}">
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<!--这里是遥测参数的编辑表单页面，对应“2.2.3 遥测参数”-->

<script>
  var callbackdata = function() {
    $('#form_satellite').submit();
    var validate = $('#form_satellite').valid();
    if (validate) {
      return [form2obj('form_satellite')];
    } else {
      return null;
    }
  };

  $(document).ready(function() {
    $.ajax({
      type : "get",
      async: false,
      url : "/bdm/subsys/getList",
      data:{"_satid":"{{sat._id}}"},
      success : function(data) {
        console.log(data)
        var arr=[];
        for(var i=0;i<data.data.length;i++){
          arr.push(data.data[i].name)
        }
        $('#subsysname').select2({
          data:arr
        });
        $("#subsysname").change(function(){
          var item=$(this).val();
          for(var i=0;i<data.data.length;i++){
            if(data.data[i].name==item){
              var Code=data.data[i].code;
              $("#subsyscode").val(Code)
            }
          }
        });
        var selectData=$("#data").val();
        $("#subsysname").val(selectData).select2();
      },
      error:function(request){
        showMessageAbnomal("通道代号获取失败")
      }
    });
    var rules = {
      tmcaption: {
        minlength: 2,
        required: true,
        remote: {
          url: 'doValidateName',
          type: 'post',
          data: {
            'name': function() {
              return $('#tmcaption').val();
            },
            '_parameterid': function() {
              return $('#_id').val();
            },
            '_satid': function() {
              return $('#_satid').val();
            }
          }
        }
      },
      tmcode: {
        minlength: 2,
        maxlength: 10,
        required: true,
        remote: {
          url: 'doValidateCode',
          type: 'post',
          data: {
            'code': function() {
              return $('#tmcode').val();
            },
            '_parameterid': function() {
              return $('#_id').val();
            },
            '_satid': function() {
              return $('#_satid').val();
            }
          }
        }
      },
      paramid: {
        minlength: 2,
        maxlength: 10,
        required: true
      }
    };
    var message = {
      tmcode: {remote: '数据类型代号不合法或已被占用'},
      tmcaption: {remote: '数据类型名称不合法或已被占用'},
    };
    bindFormValidate('#form_satellite', rules, message);
  });

</script>

{% include "./footer.html" %}
