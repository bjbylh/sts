{% include "./top.html" %}
<link href="/static/metronic/assets/global/css/components.min.css" rel="stylesheet" id="style_components"
      type="text/css"/>
<link href="/static/metronic/assets/global/css/plugins.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/metronic/assets/global/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/metronic/assets/global/plugins/select2/css/select2-bootstrap.min.css" rel="stylesheet"
      type="text/css"/>

<script src="/static/metronic/assets/global/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>
<script src="/static/metronic/assets/global/plugins/jquery-validation/js/jquery.validate.min.js"
        type="text/javascript"></script>
<script src="/static/metronic/assets/global/plugins/jquery-validation/js/additional-methods.min.js"
        type="text/javascript"></script>

<script src="/static/metronic/assets/global/plugins/jquery-validation/js/localization/messages_zh.min.js"
        type="text/javascript"></script>

<script src="/static/metronic/assets/global/scripts/app.min.js" type="text/javascript"></script>

<div class="col-md-12">
    <!-- BEGIN EXAMPLE TABLE PORTLET-->
    <div class="portlet light " style="margin-bottom: 0px;padding-bottom: 0px;">
        <div class="portlet-body form" style="padding-top: 8px !important;">
            <form class="form-horizontal" id="form_satellite">
                <div class="form-body" style="padding: 0px !important;">
                    <input type="hidden" id="_id" name="_id" value="{{data._id}}">
                    <input type="hidden" id="_satid" name="_satid" value="{{sat._id}}">
                    <input type="hidden" id="data" value="{{data.channelcode}}">
                    <div class="alert alert-danger display-hide">
                        <button class="close" data-close="alert"></button>
                        表单验证失败，请检查表单内容.
                    </div>
             <!--       <h1 style="width:100%;text-align: center">添加规则数据页面</h1>
                    {name: 'RUL_SAT', displayName: '卫星代号', size: 80},
                    {name: 'RUL_GROUP_ID', displayName: '分组标识', size: 80},
                    {name: 'RUL_ID', displayName: '判读知识标识', size: 80},
                    {name: 'RUL_NAME', displayName: '判读知识名称', size: 80},
                    {name: 'RUL_TYPE', displayName: '判读类型', size: 80},
                    {name: 'RUL_PARS', displayName: '判读参数数组', size: 80},
                    {name: 'RUL_SCRIPT', displayName: '判读知识脚本', size: 80},
                    {name: 'RUL_LIMIT_UP', displayName: '参数上限', size: 80},
                    {name: 'RUL_LIMIT_DOWN', displayName: '参数下限', size: 80},
                    {name: 'RUL_JUMP_VALUE', displayName: '参数跳变范围', size: 80},-->
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="RUL_SAT">卫星代号</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="RUL_SAT" name="RUL_SAT" value="{{data.RUL_SAT}}" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="RUL_GROUP_ID">分组标识</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="RUL_GROUP_ID" name="RUL_GROUP_ID" value="{{data.RUL_GROUP_ID}}" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="RUL_ID">判读知识标识</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="RUL_ID" name="RUL_ID" value="{{data.RUL_ID}}">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="RUL_NAME">判读知识名称</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="RUL_NAME" name="RUL_NAME" value="{{data.RUL_NAME}}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="RUL_TYPE">判读类型</label>
                                <div class="col-xs-8">
                                    <select name="RUL_TYPE" id="RUL_TYPE" class="form-control">
                                        <option value=1 {% if data.RUL_TYPE==1 %}selected{% endif %}>普通</option>
                                        <option value=2 {% if data.RUL_TYPE==2 %}selected{% endif %}>上下限</option>
                                        <option value=3 {% if data.RUL_TYPE==3 %}selected{% endif %}>工程值跳变</option>
                                        <option value=4 {% if data.RUL_TYPE==4 %}selected{% endif %}>源码跳变</option></select>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="RUL_PARS">判读参数数组</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="RUL_PARS" name="RUL_PARS" value="{{data.RUL_PARS}}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="RUL_LIMIT_UP">参数上限</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="RUL_LIMIT_UP" name="RUL_LIMIT_UP" value="{{data.RUL_LIMIT_UP}}">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-xs-4" for="RUL_LIMIT_DOWN">参数下限</label>
                                <div class="col-xs-8">
                                    <input type="text" class="form-control" id="RUL_LIMIT_DOWN" name="RUL_LIMIT_DOWN" value="{{data.RUL_LIMIT_DOWN}}">
                                </div>
                            </div>
                        </div>
                    </div>

                            <div class="form-group">
                                <label class="control-label col-xs-2" for="RUL_JUMP_VALUE">参数跳变范围</label>
                                <div class="col-xs-10">
                                    <input type="text" class="form-control" id="RUL_JUMP_VALUE" name="RUL_JUMP_VALUE" value="{{data.RUL_JUMP_VALUE}}">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-xs-2" for="RUL_SCRIPT">判读知识脚本</label>
                                <div class="col-xs-10">
                                    <textarea name="RUL_SCRIPT" id="RUL_SCRIPT" class="form-control" cols="30" rows="3"></textarea>
                                    <!--<input type="text" class="form-control" id="RUL_SCRIPT" name="RUL_SCRIPT" value="{{data.RUL_SCRIPT}}">-->
                                </div>
                            </div>

                </div>
            </form>
        </div>
    </div>
</div>
<script>
  var callbackdata = function() {
    $('#form_satellite').submit();
    var validate = $('#form_satellite').valid();
    if (validate) {
      return [form2obj('form_satellite')];
    } else {
      return null;
    }
  };

  $(document).ready(function() {
    //下拉框，联动
    $.ajax({
      type : "get",
      async: false,
      url : "/bdm/channel/getList",
      data:{"_satid":"{{sat._id}}"},
      success : function(data) {
        var arr=[];
        for(var i=0;i<data.data.length;i++){
          arr.push(data.data[i].code)
        }
        $('#channelcode').select2({
          data:arr
        });
        $("#channelcode").change(function(){
          var item=$(this).val();
          for(var i=0;i<data.data.length;i++){
            if(data.data[i].code==item){
              var Name=data.data[i].name;
              $("#channelname").val(Name)
            }
          }
        });
        var selectData=$("#data").val();
        $("#channelcode").val(selectData).select2();
      },
      error:function(request){
        showMessageAbnomal("通道代号获取失败")
      }
    });
    var rules = {
      name: {
        minlength: 2,
        required: true,
        remote: {
          url: 'doValidateName',
          type: 'post',
          data: {
            'name': function() {
              return $('#name').val();
            },
            '_vctypeid': function() {
              return $('#_id').val();
            },
            '_satid': function() {
              return $('#_satid').val();
            }
          }
        }
      },
      code: {
        minlength: 2,
        maxlength: 10,
        required: true,
        remote: {
          url: 'doValidateCode',
          type: 'post',
          data: {
            'code': function() {
              return $('#code').val();
            },
            '_vctypeid': function() {
              return $('#_id').val();
            },
            '_satid': function() {
              return $('#_satid').val();
            }
          }
        }
      }
    };
    var message = {
      code: {remote: '虚拟信道代号不合法或已被占用'},
      name: {remote: '虚拟信道名称不合法或已被占用'}
    };
    bindFormValidate('#form_satellite', rules, message);
  });

</script>

{% include "./footer.html" %}
